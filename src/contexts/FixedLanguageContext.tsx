import React, { createContext, useContext, useEffect, useState } from 'react';
import { getBestMatchLanguage } from '@/utils/languageDetector';

export type SupportedLanguage = "en" | "de" | "es" | "fr";

export interface LanguageInfo {
  code: SupportedLanguage;
  name: string;
  nativeName: string;
  flag: string;
  enabled: boolean;
}

export const availableLanguages: SupportedLanguage[] = ["en", "de", "es", "fr"];

export const languageDetails: Record<SupportedLanguage, LanguageInfo> = {
  en: {
    code: "en",
    name: "English",
    nativeName: "English",
    flag: "üá¨üáß",
    enabled: true
  },
  de: {
    code: "de",
    name: "German",
    nativeName: "Deutsch",
    flag: "üá©üá™",
    enabled: true
  },
  es: {
    code: "es",
    name: "Spanish",
    nativeName: "Espa√±ol",
    flag: "üá™üá∏",
    enabled: true
  },
  fr: {
    code: "fr",
    name: "French",
    nativeName: "Fran√ßais",
    flag: "üá´üá∑",
    enabled: true
  }
};

// Base translations object
const baseTranslations: Record<string, Record<string, string>> = {
  en: {
    welcome: "Welcome",
    settings: "Settings",
    profile: "Profile",
    display: "Display",
    notifications: "Notifications",
    language: "Language",
    security: "Security",
    darkMode: "Dark Mode",
    lightMode: "Light Mode",
    systemPreference: "System Preference",
    changeTheme: "Change Theme",
    light: "Light",
    dark: "Dark",
    system: "System",
    changeLanguage: "Change Language",
    changeInterfaceLanguage: "Change the interface language",
    languageSettings: "Language Settings",
    settingsUpdated: "Settings Updated",
    settingUpdated: "Setting Updated",
    highContrastEnabled: "High contrast mode enabled",
    highContrastDisabled: "High contrast mode disabled",
    largeTextEnabled: "Large text mode enabled",
    largeTextDisabled: "Large text mode disabled",
    reduceMotionEnabled: "Reduced motion enabled",
    reduceMotionDisabled: "Reduced motion disabled",
    keyboardModeEnabled: "Keyboard navigation mode enabled",
    keyboardModeDisabled: "Keyboard navigation mode disabled",
    screenReaderEnabled: "Screen reader optimizations enabled",
    screenReaderDisabled: "Screen reader optimizations disabled",
    dyslexiaFriendlyEnabled: "Dyslexia friendly mode enabled",
    dyslexiaFriendlyDisabled: "Dyslexia friendly mode disabled",
    settingsReset: "Settings Reset",
    accessibilitySettingsReset: "All accessibility settings have been reset",
    accessibilitySettings: "Accessibility Settings",
    accessibilityDescription: "Customize your experience for better accessibility",
    visual: "Visual",
    interaction: "Interaction",
    content: "Content",
    highContrast: "High Contrast",
    highContrastDescription: "Increase contrast for better readability",
    largeText: "Large Text",
    largeTextDescription: "Increase text size for better readability",
    reduceMotion: "Reduce Motion",
    reduceMotionDescription: "Minimize animations and transitions",
    keyboardMode: "Keyboard Navigation",
    keyboardModeDescription: "Optimize for keyboard navigation",
    screenReader: "Screen Reader Optimizations",
    screenReaderDescription: "Enhance compatibility with screen readers",
    dyslexiaFriendly: "Dyslexia Friendly",
    dyslexiaFriendlyDescription: "Use fonts and layouts optimized for dyslexia",
    resetToDefaults: "Reset to Defaults",
    done: "Done",
    featureNotification: "Feature Preview",
    featureComingSoon: "is coming soon to your dashboard",
    navigatingToAccessibilitySettings: "Navigating to accessibility settings",
    
    // Portfolio dashboard translations
    investmentPortfolio: "Investment Portfolio",
    trackYourRealEstateInvestments: "Track and manage your real estate investments",
    analytics: "Analytics",
    projections: "Projections",
    propertyComparison: "Property Comparison",
    cashFlow: "Cash Flow",
    allocation: "Allocation",
    propertyPerformance: "Property Performance",
    compareYourInvestments: "Compare the performance of your investments",
    portfolioProjections: "Portfolio Projections",
    simulateYourPortfolioGrowth: "Simulate your portfolio growth with different scenarios",
    cashFlowAnalysis: "Cash Flow Analysis",
    cashFlowAnalysisDescription: "Detailed analysis of your property cash flows",
    unlockCashFlowAnalysis: "Unlock Cash Flow Analysis",
    assetAllocation: "Asset Allocation",
    assetAllocationDescription: "View your portfolio diversity across property types and locations",
    unlockAssetAllocation: "Unlock Asset Allocation",
    investorMetrics: "Investor Metrics",
    keyPerformanceIndicators: "Key Performance Indicators",
    exportMetrics: "Export Metrics",
    exportData: "Export Data",
    capRate: "Cap Rate",
    netIncomeDividedByValue: "Net income divided by property value",
    cashOnCash: "Cash on Cash",
    annualCashFlowDividedByInvestment: "Annual cash flow divided by initial investment",
    debtServiceCoverage: "Debt Service Coverage",
    netOperatingIncomeToDebtRatio: "Net operating income to debt ratio",
    breakEvenOccupancy: "Break-even Occupancy",
    minimumOccupancyToBreakEven: "Minimum occupancy needed to break even",
    enhancedAnalytics: "Enhanced Analytics",
    enhancedAnalyticsDescription: "Unlock detailed ROI analysis with advanced metrics",
    unlockAnalytics: "Unlock Analytics",
    viewDetailed: "View Detailed",
    marketInsights: "Market Insights",
    marketInsightsDescription: "Connect market data to see how property values are trending",
    connectMarketData: "Connect Market Data",
    
    // New translations for customizable dashboard
    customizeDashboard: "Customize Dashboard",
    saveLayout: "Save Layout",
    resetLayout: "Reset Layout",
    dragToResize: "Drag to resize",
    addWidget: "Add Widget",
    removeWidget: "Remove Widget",
    layoutSaved: "Dashboard layout saved",
    layoutReset: "Dashboard layout reset",
    selectWidgets: "Select Widgets to Display",
    dashboardCustomization: "Dashboard Customization",
    applyChanges: "Apply Changes",
    cancelChanges: "Cancel",
    widgetSettings: "Widget Settings",
    widgetSize: "Widget Size",
    small: "Small",
    medium: "Medium",
    large: "Large",
    selectLocation: "Select Location",
    
    // For Security Alert
    securityAlert: "Security Alert",
    securityAlertDescription: "We recommend setting up a PIN for additional security.",
    setupPIN: "Setup PIN",
    dismiss: "Dismiss",
    securityEnabled: "Security Enabled",
    securityEnabledDescription: "Your app is now secured with PIN protection",
  },
  
  de: {
    welcome: "Willkommen",
    settings: "Einstellungen",
    profile: "Profil",
    display: "Anzeige",
    notifications: "Benachrichtigungen",
    language: "Sprache",
    security: "Sicherheit",
    darkMode: "Dunkler Modus",
    lightMode: "Heller Modus",
    systemPreference: "Systemeinstellung",
    changeTheme: "Design √§ndern",
    light: "Hell",
    dark: "Dunkel",
    system: "System",
    changeLanguage: "Sprache √§ndern",
    changeInterfaceLanguage: "√Ñndern Sie die Sprache der Benutzeroberfl√§che",
    languageSettings: "Spracheinstellungen",
    settingsUpdated: "Einstellungen aktualisiert",
    settingUpdated: "Einstellung aktualisiert",
    highContrastEnabled: "Hochkontrastmodus aktiviert",
    highContrastDisabled: "Hochkontrastmodus deaktiviert",
    largeTextEnabled: "Gro√üer Text aktiviert",
    largeTextDisabled: "Gro√üer Text deaktiviert",
    reduceMotionEnabled: "Bewegungsreduzierung aktiviert",
    reduceMotionDisabled: "Bewegungsreduzierung deaktiviert",
    keyboardModeEnabled: "Tastaturnavigationsmodus aktiviert",
    keyboardModeDisabled: "Tastaturnavigationsmodus deaktiviert",
    screenReaderEnabled: "Screenreader-Optimierungen aktiviert",
    screenReaderDisabled: "Screenreader-Optimierungen deaktiviert",
    dyslexiaFriendlyEnabled: "Legasthenie-freundlicher Modus aktiviert",
    dyslexiaFriendlyDisabled: "Legasthenie-freundlicher Modus deaktiviert",
    settingsReset: "Einstellungen zur√ºckgesetzt",
    accessibilitySettingsReset: "Alle Zug√§nglichkeitseinstellungen wurden zur√ºckgesetzt",
    accessibilitySettings: "Barrierefreiheit",
    accessibilityDescription: "Passen Sie Ihre Erfahrung f√ºr bessere Zug√§nglichkeit an",
    visual: "Visuell",
    interaction: "Interaktion",
    content: "Inhalt",
    highContrast: "Hoher Kontrast",
    highContrastDescription: "Erh√∂hen Sie den Kontrast f√ºr bessere Lesbarkeit",
    largeText: "Gro√üer Text",
    largeTextDescription: "Textgr√∂√üe f√ºr bessere Lesbarkeit erh√∂hen",
    reduceMotion: "Bewegung reduzieren",
    reduceMotionDescription: "Animationen und √úberg√§nge minimieren",
    keyboardMode: "Tastaturnavigation",
    keyboardModeDescription: "F√ºr Tastaturnavigation optimieren",
    screenReader: "Screenreader-Optimierungen",
    screenReaderDescription: "Verbesserte Kompatibilit√§t mit Screenreadern",
    dyslexiaFriendly: "Legasthenie-freundlich",
    dyslexiaFriendlyDescription: "Schriftarten und Layouts f√ºr Legastheniker optimiert",
    resetToDefaults: "Auf Standardwerte zur√ºcksetzen",
    done: "Fertig",
    featureNotification: "Funktionsvorschau",
    featureComingSoon: "wird bald auf Ihrem Dashboard verf√ºgbar sein",
    navigatingToAccessibilitySettings: "Navigation zu Barrierefreiheit-Einstellungen",
    
    // Portfolio dashboard translations
    investmentPortfolio: "Investitionsportfolio",
    trackYourRealEstateInvestments: "Verfolgen und verwalten Sie Ihre Immobilieninvestitionen",
    analytics: "Analysen",
    projections: "Prognosen",
    propertyComparison: "Immobilienvergleich",
    cashFlow: "Cashflow",
    allocation: "Verteilung",
    propertyPerformance: "Immobilienperformance",
    compareYourInvestments: "Vergleichen Sie die Performance Ihrer Investitionen",
    portfolioProjections: "Portfolio-Prognosen",
    simulateYourPortfolioGrowth: "Simulieren Sie Ihr Portfolio-Wachstum mit verschiedenen Szenarien",
    cashFlowAnalysis: "Cashflow-Analyse",
    cashFlowAnalysisDescription: "Detaillierte Analyse Ihrer Immobilien-Cashflows",
    unlockCashFlowAnalysis: "Cashflow-Analyse freischalten",
    assetAllocation: "Asset-Allokation",
    assetAllocationDescription: "Sehen Sie Ihre Portfolio-Diversit√§t √ºber Immobilienarten und Standorte hinweg",
    unlockAssetAllocation: "Asset-Allokation freischalten",
    investorMetrics: "Investorenkennzahlen",
    keyPerformanceIndicators: "Schl√ºsselleistungsindikatoren",
    exportMetrics: "Metriken exportieren",
    exportData: "Daten exportieren",
    capRate: "Kapitalisierungsrate",
    netIncomeDividedByValue: "Nettoeinkommen geteilt durch Immobilienwert",
    cashOnCash: "Cash-on-Cash",
    annualCashFlowDividedByInvestment: "J√§hrlicher Cashflow geteilt durch Anfangsinvestition",
    debtServiceCoverage: "Schuldendienstdeckung",
    netOperatingIncomeToDebtRatio: "Verh√§ltnis von Betriebsergebnis zu Schulden",
    breakEvenOccupancy: "Break-Even-Belegung",
    minimumOccupancyToBreakEven: "Mindestbelegung zum Break-Even",
    enhancedAnalytics: "Erweiterte Analysen",
    enhancedAnalyticsDescription: "Schalten Sie detaillierte ROI-Analysen mit erweiterten Metriken frei",
    unlockAnalytics: "Analysen freischalten",
    viewDetailed: "Detailliert anzeigen",
    marketInsights: "Markteinblicke",
    marketInsightsDescription: "Verbinden Sie Marktdaten, um zu sehen, wie sich Immobilienwerte entwickeln",
    connectMarketData: "Marktdaten verbinden",
    
    // New translations for customizable dashboard
    customizeDashboard: "Dashboard anpassen",
    saveLayout: "Layout speichern",
    resetLayout: "Layout zur√ºcksetzen",
    dragToResize: "Ziehen zum Anpassen der Gr√∂√üe",
    addWidget: "Widget hinzuf√ºgen",
    removeWidget: "Widget entfernen",
    layoutSaved: "Dashboard-Layout gespeichert",
    layoutReset: "Dashboard-Layout zur√ºckgesetzt",
    selectWidgets: "Widgets zur Anzeige ausw√§hlen",
    dashboardCustomization: "Dashboard-Anpassung",
    applyChanges: "√Ñnderungen anwenden",
    cancelChanges: "Abbrechen",
    widgetSettings: "Widget-Einstellungen",
    widgetSize: "Widget-Gr√∂√üe",
    small: "Klein",
    medium: "Mittel",
    large: "Gro√ü",
    selectLocation: "Standort ausw√§hlen",
    
    // For Security Alert
    securityAlert: "Sicherheitshinweis",
    securityAlertDescription: "Wir empfehlen das Einrichten einer PIN f√ºr zus√§tzliche Sicherheit.",
    setupPIN: "PIN einrichten",
    dismiss: "Ablehnen",
    securityEnabled: "Sicherheit aktiviert",
    securityEnabledDescription: "Ihr Konto ist durch PIN-Sicherheit gesch√ºtzt.",
  },
  
  es: {
    welcome: "Bienvenido",
    settings: "Configuraci√≥n",
    profile: "Perfil",
    display: "Pantalla",
    notifications: "Notificaciones",
    language: "Idioma",
    security: "Seguridad",
    darkMode: "Modo oscuro",
    lightMode: "Modo claro",
    systemPreference: "Preferencia del sistema",
    changeTheme: "Cambiar tema",
    light: "Claro",
    dark: "Oscuro",
    system: "Sistema",
    changeLanguage: "Cambiar idioma",
    changeInterfaceLanguage: "Cambiar el idioma de la interfaz",
    languageSettings: "Configuraci√≥n de idioma",
    settingsUpdated: "Configuraci√≥n actualizada",
    settingUpdated: "Configuraci√≥n actualizada",
    highContrastEnabled: "Modo de alto contraste activado",
    highContrastDisabled: "Modo de alto contraste desactivado",
    largeTextEnabled: "Modo de texto grande activado",
    largeTextDisabled: "Modo de texto grande desactivado",
    reduceMotionEnabled: "Reducci√≥n de movimiento activada",
    reduceMotionDisabled: "Reducci√≥n de movimiento desactivada",
    keyboardModeEnabled: "Modo de navegaci√≥n por teclado activado",
    keyboardModeDisabled: "Modo de navegaci√≥n por teclado desactivado",
    screenReaderEnabled: "Optimizaciones para lectores de pantalla activadas",
    screenReaderDisabled: "Optimizaciones para lectores de pantalla desactivadas",
    dyslexiaFriendlyEnabled: "Modo amigable para dislexia activado",
    dyslexiaFriendlyDisabled: "Modo amigable para dislexia desactivado",
    settingsReset: "Configuraci√≥n restablecida",
    accessibilitySettingsReset: "Todas las configuraciones de accesibilidad se han restablecido",
    accessibilitySettings: "Configuraci√≥n de accesibilidad",
    accessibilityDescription: "Personalice su experiencia para una mejor accesibilidad",
    visual: "Visual",
    interaction: "Interacci√≥n",
    content: "Contenido",
    highContrast: "Alto contraste",
    highContrastDescription: "Aumentar el contraste para una mejor legibilidad",
    largeText: "Texto grande",
    largeTextDescription: "Aumentar el tama√±o del texto para una mejor legibilidad",
    reduceMotion: "Reducir movimiento",
    reduceMotionDescription: "Minimizar animaciones y transiciones",
    keyboardMode: "Navegaci√≥n por teclado",
    keyboardModeDescription: "Optimizar para navegaci√≥n por teclado",
    screenReader: "Optimizaciones para lectores de pantalla",
    screenReaderDescription: "Mejorar la compatibilidad con lectores de pantalla",
    dyslexiaFriendly: "Amigable para dislexia",
    dyslexiaFriendlyDescription: "Usar fuentes y dise√±os optimizados para dislexia",
    resetToDefaults: "Restablecer a valores predeterminados",
    done: "Hecho",
    featureNotification: "Vista previa de funci√≥n",
    featureComingSoon: "estar√° disponible pr√≥ximamente en su panel",
    navigatingToAccessibilitySettings: "Navegando a configuraci√≥n de accesibilidad",
    
    // Portfolio dashboard translations
    investmentPortfolio: "Cartera de inversiones",
    trackYourRealEstateInvestments: "Seguimiento y gesti√≥n de sus inversiones inmobiliarias",
    analytics: "An√°lisis",
    projections: "Proyecciones",
    propertyComparison: "Comparaci√≥n de propiedades",
    cashFlow: "Flujo de caja",
    allocation: "Asignaci√≥n",
    propertyPerformance: "Rendimiento de propiedades",
    compareYourInvestments: "Compare el rendimiento de sus inversiones",
    portfolioProjections: "Proyecciones de cartera",
    simulateYourPortfolioGrowth: "Simule el crecimiento de su cartera con diferentes escenarios",
    cashFlowAnalysis: "An√°lisis de flujo de caja",
    cashFlowAnalysisDescription: "An√°lisis detallado de los flujos de caja de sus propiedades",
    unlockCashFlowAnalysis: "Desbloquear an√°lisis de flujo de caja",
    assetAllocation: "Asignaci√≥n de activos",
    assetAllocationDescription: "Vea la diversidad de su cartera entre tipos de propiedades y ubicaciones",
    unlockAssetAllocation: "Desbloquear asignaci√≥n de activos",
    investorMetrics: "M√©tricas de inversor",
    keyPerformanceIndicators: "Indicadores clave de rendimiento",
    exportMetrics: "Exportar m√©tricas",
    exportData: "Exportar datos",
    capRate: "Tasa de capitalizaci√≥n",
    netIncomeDividedByValue: "Ingreso neto dividido por valor de propiedad",
    cashOnCash: "Efectivo sobre efectivo",
    annualCashFlowDividedByInvestment: "Flujo de caja anual dividido por inversi√≥n inicial",
    debtServiceCoverage: "Cobertura de servicio de deuda",
    netOperatingIncomeToDebtRatio: "Relaci√≥n entre ingreso operativo neto y deuda",
    breakEvenOccupancy: "Ocupaci√≥n de equilibrio",
    minimumOccupancyToBreakEven: "Ocupaci√≥n m√≠nima necesaria para equilibrar",
    enhancedAnalytics: "An√°lisis mejorado",
    enhancedAnalyticsDescription: "Desbloquee an√°lisis detallados de ROI con m√©tricas avanzadas",
    unlockAnalytics: "Desbloquear an√°lisis",
    viewDetailed: "Ver detallado",
    marketInsights: "Informaci√≥n de mercado",
    marketInsightsDescription: "Conecte datos de mercado para ver c√≥mo evolucionan los valores de las propiedades",
    connectMarketData: "Conectar datos de mercado",
    
    // New translations for customizable dashboard
    customizeDashboard: "Personalizar panel",
    saveLayout: "Guardar dise√±o",
    resetLayout: "Restablecer dise√±o",
    dragToResize: "Arrastrar para cambiar tama√±o",
    addWidget: "A√±adir widget",
    removeWidget: "Eliminar widget",
    layoutSaved: "Dise√±o del panel guardado",
    layoutReset: "Dise√±o del panel restablecido",
    selectWidgets: "Seleccionar widgets para mostrar",
    dashboardCustomization: "Personalizaci√≥n del panel",
    applyChanges: "Aplicar cambios",
    cancelChanges: "Cancelar",
    widgetSettings: "Configuraci√≥n de widget",
    widgetSize: "Tama√±o de widget",
    small: "Peque√±o",
    medium: "Mediano",
    large: "Grande",
    selectLocation: "Seleccionar ubicaci√≥n",
    
    // For Security Alert
    securityAlert: "Alerta de seguridad",
    securityAlertDescription: "Recomendamos configurar un PIN para seguridad adicional.",
    setupPIN: "Configurar PIN",
    dismiss: "Descartar",
    securityEnabled: "Seguridad habilitada",
    securityEnabledDescription: "Su cuenta est√° protegida con seguridad PIN.",
  },
  
  fr: {
    welcome: "Bienvenue",
    settings: "Param√®tres",
    profile: "Profil",
    display: "Affichage",
    notifications: "Notifications",
    language: "Langue",
    security: "S√©curit√©",
    darkMode: "Mode sombre",
    lightMode: "Mode clair",
    systemPreference: "Pr√©f√©rence syst√®me",
    changeTheme: "Changer de th√®me",
    light: "Clair",
    dark: "Sombre",
    system: "Syst√®me",
    changeLanguage: "Changer de langue",
    changeInterfaceLanguage: "Modifier la langue de l'interface",
    languageSettings: "Param√®tres de langue",
    settingsUpdated: "Param√®tres mis √† jour",
    settingUpdated: "Param√®tre mis √† jour",
    highContrastEnabled: "Mode contraste √©lev√© activ√©",
    highContrastDisabled: "Mode contraste √©lev√© d√©sactiv√©",
    largeTextEnabled: "Mode texte large activ√©",
    largeTextDisabled: "Mode texte large d√©sactiv√©",
    reduceMotionEnabled: "R√©duction de mouvement activ√©e",
    reduceMotionDisabled: "R√©duction de mouvement d√©sactiv√©e",
    keyboardModeEnabled: "Mode navigation au clavier activ√©",
    keyboardModeDisabled: "Mode navigation au clavier d√©sactiv√©",
    screenReaderEnabled: "Optimisations pour lecteurs d'√©cran activ√©es",
    screenReaderDisabled: "Optimisations pour lecteurs d'√©cran d√©sactiv√©es",
    dyslexiaFriendlyEnabled: "Mode adapt√© √† la dyslexie activ√©",
    dyslexiaFriendlyDisabled: "Mode adapt√© √† la dyslexie d√©sactiv√©",
    settingsReset: "Param√®tres r√©initialis√©s",
    accessibilitySettingsReset: "Tous les param√®tres d'accessibilit√© ont √©t√© r√©initialis√©s",
    accessibilitySettings: "Param√®tres d'accessibilit√©",
    accessibilityDescription: "Personnalisez votre exp√©rience pour une meilleure accessibilit√©",
    visual: "Visuel",
    interaction: "Interaction",
    content: "Contenu",
    highContrast: "Contraste √©lev√©",
    highContrastDescription: "Augmenter le contraste pour une meilleure lisibilit√©",
    largeText: "Texte large",
    largeTextDescription: "Augmenter la taille du texte pour une meilleure lisibilit√©",
    reduceMotion: "R√©duire le mouvement",
    reduceMotionDescription: "Minimiser les animations et transitions",
    keyboardMode: "Navigation au clavier",
    keyboardModeDescription: "Optimiser pour la navigation au clavier",
    screenReader: "Optimisations pour lecteurs d'√©cran",
    screenReaderDescription: "Am√©liorer la compatibilit√© avec les lecteurs d'√©cran",
    dyslexiaFriendly: "Adapt√© √† la dyslexie",
    dyslexiaFriendlyDescription: "Utiliser des polices et des mises en page optimis√©es pour la dyslexie",
    resetToDefaults: "R√©initialiser aux valeurs par d√©faut",
    done: "Termin√©",
    featureNotification: "Aper√ßu de fonctionnalit√©",
    featureComingSoon: "sera bient√¥t disponible sur votre tableau de bord",
    navigatingToAccessibilitySettings: "Navigation vers les param√®tres d'accessibilit√©",
    
    // Portfolio dashboard translations
    investmentPortfolio: "Portefeuille d'investissement",
    trackYourRealEstateInvestments: "Suivez et g√©rez vos investissements immobiliers",
    analytics: "Analyses",
    projections: "Projections",
    propertyComparison: "Comparaison de biens",
    cashFlow: "Flux de tr√©sorerie",
    allocation: "Allocation",
    propertyPerformance: "Performance des biens",
    compareYourInvestments: "Comparez la performance de vos investissements",
    portfolioProjections: "Projections de portefeuille",
    simulateYourPortfolioGrowth: "Simulez la croissance de votre portefeuille avec diff√©rents sc√©narios",
    cashFlowAnalysis: "Analyse des flux de tr√©sorerie",
    cashFlowAnalysisDescription: "Analyse d√©taill√©e des flux de tr√©sorerie de vos biens",
    unlockCashFlowAnalysis: "D√©bloquer l'analyse des flux de tr√©sorerie",
    assetAllocation: "Allocation d'actifs",
    assetAllocationDescription: "Visualisez la diversit√© de votre portefeuille √† travers les types de biens et les emplacements",
    unlockAssetAllocation: "D√©bloquer l'allocation d'actifs",
    investorMetrics: "M√©triques d'investisseur",
    keyPerformanceIndicators: "Indicateurs de performance cl√©s",
    exportMetrics: "Exporter les m√©triques",
    exportData: "Exporter les donn√©es",
    capRate: "Taux de capitalisation",
    netIncomeDividedByValue: "Revenu net divis√© par la valeur du bien",
    cashOnCash: "Cash-on-Cash",
    annualCashFlowDividedByInvestment: "Flux de tr√©sorerie annuel divis√© par investissement initial",
    debtServiceCoverage: "Couverture du service de la dette",
    netOperatingIncomeToDebtRatio: "Ratio du revenu d'exploitation net √† la dette",
    breakEvenOccupancy: "Occupation du point mort",
    minimumOccupancyToBreakEven: "Occupation minimale n√©cessaire pour atteindre le point mort",
    enhancedAnalytics: "Analyses am√©lior√©es",
    enhancedAnalyticsDescription: "D√©bloquez des analyses ROI d√©taill√©es avec des m√©triques avanc√©es",
    unlockAnalytics: "D√©bloquer les analyses",
    viewDetailed: "Voir d√©taill√©",
    marketInsights: "Aper√ßus du march√©",
    marketInsightsDescription: "Connectez des donn√©es de march√© pour voir comment les valeurs immobili√®res √©voluent",
    connectMarketData: "Connecter les donn√©es de march√©",
    
    // New translations for customizable dashboard
    customizeDashboard: "Personnaliser le tableau de bord",
    saveLayout: "Enregistrer la disposition",
    resetLayout: "R√©initialiser la disposition",
    dragToResize: "Faites glisser pour redimensionner",
    addWidget: "Ajouter un widget",
    removeWidget: "Supprimer un widget",
    layoutSaved: "Disposition du tableau de bord enregistr√©e",
    layoutReset: "Disposition du tableau de bord r√©initialis√©e",
    selectWidgets: "S√©lectionner les widgets √† afficher",
    dashboardCustomization: "Personnalisation du tableau de bord",
    applyChanges: "Appliquer les modifications",
    cancelChanges: "Annuler",
    widgetSettings: "Param√®tres du widget",
    widgetSize: "Taille du widget",
    small: "Petit",
    medium: "Moyen",
    large: "Grand",
    selectLocation: "S√©lectionner l'emplacement",
    
    // For Security Alert
    securityAlert: "Alerte de s√©curit√©",
    securityAlertDescription: "Nous recommandons de configurer un PIN pour une s√©curit√© suppl√©mentaire.",
    setupPIN: "Configurer un PIN",
    dismiss: "Ignorer",
    securityEnabled: "S√©curit√© activ√©e",
    securityEnabledDescription: "Votre compte est prot√©g√© par une s√©curit√© PIN.",
  }
};

interface LanguageContextProps {
  language: SupportedLanguage;
  setLanguage: (language: SupportedLanguage) => void;
  t: (key: string, params?: Record<string, string>) => string;
  translations: Record<string, Record<string, string>>;
  availableLanguages: SupportedLanguage[];
  languageDetails: Record<SupportedLanguage, LanguageInfo>;
}

const LanguageContext = createContext<LanguageContextProps>({
  language: "en",
  setLanguage: () => {},
  t: () => "",
  translations: baseTranslations,
  availableLanguages,
  languageDetails,
});

export const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<SupportedLanguage>(() => {
    // Try to get language from localStorage
    const savedLang = localStorage.getItem('language') as SupportedLanguage | null;
    
    // If we have a valid saved language, use it
    if (savedLang && availableLanguages.includes(savedLang)) {
      return savedLang;
    }
    
    // Otherwise detect the best match from browser settings
    return getBestMatchLanguage(availableLanguages) as SupportedLanguage || "en";
  });
  
  const [translations, setTranslations] = useState(baseTranslations);
  
  // Set the language in localStorage when it changes
  useEffect(() => {
    localStorage.setItem('language', language);
    
    // Update document language attribute for accessibility
    document.documentElement.setAttribute('lang', language);
  }, [language]);
  
  // Translation function
  const t = (key: string, params?: Record<string, string>): string => {
    const translation = translations[language]?.[key] || translations.en?.[key] || key;
    
    if (!params) {
      return translation;
    }
    
    // Replace parameters in translation string
    return Object.entries(params).reduce(
      (str, [param, value]) => str.replace(new RegExp(`{${param}}`, 'g'), value),
      translation
    );
  };
  
  return (
    <LanguageContext.Provider
      value={{
        language,
        setLanguage,
        t,
        translations,
        availableLanguages,
        languageDetails
      }}
    >
      {children}
    </LanguageContext.Provider>
  );
};

export const useLanguage = () => useContext(LanguageContext);
