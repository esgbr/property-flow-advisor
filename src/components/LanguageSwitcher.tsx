
import React, { useEffect } from 'react';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
  DropdownMenuLabel,
  DropdownMenuSeparator
} from '@/components/ui/dropdown-menu';
import { Button } from '@/components/ui/button';
import { useLanguage } from '@/contexts/LanguageContext';
import { Languages } from 'lucide-react';
import { useIsMobile } from '@/hooks/use-mobile';
import { Badge } from '@/components/ui/badge';
import { useToast } from '@/hooks/use-toast';

const LanguageSwitcher = () => {
  const { language, setLanguage, t, translations, updateTranslations } = useLanguage();
  const isMobile = useIsMobile();
  const { toast } = useToast();

  const languages = [
    { code: 'en', name: 'English', flag: 'üá¨üáß' },
    { code: 'de', name: 'Deutsch', flag: 'üá©üá™' },
    { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },
    { code: 'fr', name: 'Fran√ßais', flag: 'üá´üá∑' },
    { code: 'it', name: 'Italiano', flag: 'üáÆüáπ' },
  ];
  
  useEffect(() => {
    // Ensure all languages have proper translations for common UI elements
    const ensureTranslations = () => {
      const commonTranslations = {
        // Navigation and common UI elements
        dashboard: {
          en: 'Dashboard',
          de: 'Dashboard',
          es: 'Panel de control',
          fr: 'Tableau de bord',
          it: 'Dashboard'
        },
        properties: {
          en: 'Properties',
          de: 'Immobilien',
          es: 'Propiedades',
          fr: 'Propri√©t√©s',
          it: 'Propriet√†'
        },
        analytics: {
          en: 'Analytics',
          de: 'Analysen',
          es: 'Anal√≠tica',
          fr: 'Analytique',
          it: 'Analisi'
        },
        settings: {
          en: 'Settings',
          de: 'Einstellungen',
          es: 'Configuraci√≥n',
          fr: 'Param√®tres',
          it: 'Impostazioni'
        },
        investmentCalculator: {
          en: 'Investment Calculator',
          de: 'Investitionsrechner',
          es: 'Calculadora de inversi√≥n',
          fr: 'Calculateur d\'investissement',
          it: 'Calcolatore d\'investimento'
        },
        education: {
          en: 'Education Center',
          de: 'Bildungszentrum',
          es: 'Centro educativo',
          fr: 'Centre d\'√©ducation',
          it: 'Centro educativo'
        },
        // Property-related terms
        property: {
          en: 'Property',
          de: 'Immobilie',
          es: 'Propiedad',
          fr: 'Propri√©t√©',
          it: 'Propriet√†'
        },
        address: {
          en: 'Address',
          de: 'Adresse',
          es: 'Direcci√≥n',
          fr: 'Adresse',
          it: 'Indirizzo'
        },
        price: {
          en: 'Price',
          de: 'Preis',
          es: 'Precio',
          fr: 'Prix',
          it: 'Prezzo'
        },
        // Button and action labels
        save: {
          en: 'Save',
          de: 'Speichern',
          es: 'Guardar',
          fr: 'Enregistrer',
          it: 'Salvare'
        },
        cancel: {
          en: 'Cancel',
          de: 'Abbrechen',
          es: 'Cancelar',
          fr: 'Annuler',
          it: 'Annullare'
        },
        edit: {
          en: 'Edit',
          de: 'Bearbeiten',
          es: 'Editar',
          fr: 'Modifier',
          it: 'Modificare'
        },
        editProperty: {
          en: 'Edit Property',
          de: 'Immobilie bearbeiten',
          es: 'Editar propiedad',
          fr: 'Modifier la propri√©t√©',
          it: 'Modifica propriet√†'
        },
        delete: {
          en: 'Delete',
          de: 'L√∂schen',
          es: 'Eliminar',
          fr: 'Supprimer',
          it: 'Eliminare'
        },
        // Language switcher specific translations
        language: {
          en: 'Language',
          de: 'Sprache',
          es: 'Idioma',
          fr: 'Langue',
          it: 'Lingua'
        },
        selectLanguage: {
          en: 'Select Language',
          de: 'Sprache ausw√§hlen',
          es: 'Seleccionar idioma',
          fr: 'S√©lectionner la langue',
          it: 'Seleziona la lingua'
        },
        active: {
          en: 'Active',
          de: 'Aktiv',
          es: 'Activo',
          fr: 'Actif',
          it: 'Attivo'
        },
        languageChanged: {
          en: 'Language Changed',
          de: 'Sprache ge√§ndert',
          es: 'Idioma cambiado',
          fr: 'Langue chang√©e',
          it: 'Lingua cambiata'
        },
        displayLanguageChangedTo: {
          en: 'Display language changed to',
          de: 'Anzeigesprache ge√§ndert zu',
          es: 'Idioma de visualizaci√≥n cambiado a',
          fr: 'Langue d\'affichage chang√©e en',
          it: 'Lingua cambiata in'
        },
        // Property form translations
        propertyTitle: {
          en: 'Property Title',
          de: 'Immobilientitel',
          es: 'T√≠tulo de la propiedad',
          fr: 'Titre de la propri√©t√©',
          it: 'Titolo della propriet√†'
        },
        enterPropertyTitle: {
          en: 'Enter property title',
          de: 'Immobilientitel eingeben',
          es: 'Ingresar t√≠tulo de la propiedad',
          fr: 'Entrer le titre de la propri√©t√©',
          it: 'Inserisci il titolo della propriet√†'
        },
        propertyType: {
          en: 'Property Type',
          de: 'Immobilientyp',
          es: 'Tipo de propiedad',
          fr: 'Type de propri√©t√©',
          it: 'Tipo di propriet√†'
        },
        selectPropertyType: {
          en: 'Select property type',
          de: 'Immobilientyp ausw√§hlen',
          es: 'Seleccionar tipo de propiedad',
          fr: 'S√©lectionner le type de propri√©t√©',
          it: 'Seleziona il tipo di propriet√†'
        },
        apartment: {
          en: 'Apartment',
          de: 'Wohnung',
          es: 'Apartamento',
          fr: 'Appartement',
          it: 'Appartamento'
        },
        house: {
          en: 'House',
          de: 'Haus',
          es: 'Casa',
          fr: 'Maison',
          it: 'Casa'
        },
        condo: {
          en: 'Condo',
          de: 'Eigentumswohnung',
          es: 'Condominio',
          fr: 'Copropri√©t√©',
          it: 'Condominio'
        },
        townhouse: {
          en: 'Townhouse',
          de: 'Reihenhaus',
          es: 'Casa adosada',
          fr: 'Maison de ville',
          it: 'Casa a schiera'
        },
        land: {
          en: 'Land',
          de: 'Grundst√ºck',
          es: 'Terreno',
          fr: 'Terrain',
          it: 'Terreno'
        },
        commercial: {
          en: 'Commercial',
          de: 'Gewerbe',
          es: 'Comercial',
          fr: 'Commercial',
          it: 'Commerciale'
        },
        // Address form related translations
        startTypingForAddressSuggestions: {
          en: 'Start typing to get address suggestions...',
          de: 'Beginnen Sie zu tippen, um Adressvorschl√§ge zu erhalten...',
          es: 'Comience a escribir para obtener sugerencias de direcciones...',
          fr: 'Commencez √† taper pour obtenir des suggestions d\'adresses...',
          it: 'Inizia a digitare per ottenere suggerimenti di indirizzi...'
        },
        loadingAddressSuggestions: {
          en: 'Loading address suggestions...',
          de: 'Adressvorschl√§ge werden geladen...',
          es: 'Cargando sugerencias de direcciones...',
          fr: 'Chargement des suggestions d\'adresses...',
          it: 'Caricamento suggerimenti indirizzi...'
        },
        startTypingForGoogleMaps: {
          en: 'Start typing to get address suggestions from Google Maps',
          de: 'Beginnen Sie zu tippen, um Adressvorschl√§ge von Google Maps zu erhalten',
          es: 'Comience a escribir para obtener sugerencias de direcciones de Google Maps',
          fr: 'Commencez √† taper pour obtenir des suggestions d\'adresses de Google Maps',
          it: 'Inizia a digitare per ottenere suggerimenti di indirizzi da Google Maps'
        },
        enterAddressManually: {
          en: 'Please enter your address manually',
          de: 'Bitte geben Sie Ihre Adresse manuell ein',
          es: 'Por favor, ingrese su direcci√≥n manualmente',
          fr: 'Veuillez saisir votre adresse manuellement',
          it: 'Inserisci il tuo indirizzo manualmente'
        },
        addressVerified: {
          en: 'Address Verified',
          de: 'Adresse verifiziert',
          es: 'Direcci√≥n verificada',
          fr: 'Adresse v√©rifi√©e',
          it: 'Indirizzo verificato'
        },
        addressVerifiedDescription: {
          en: 'The address has been verified and updated with Google Maps data.',
          de: 'Die Adresse wurde verifiziert und mit Google Maps-Daten aktualisiert.',
          es: 'La direcci√≥n ha sido verificada y actualizada con datos de Google Maps.',
          fr: 'L\'adresse a √©t√© v√©rifi√©e et mise √† jour avec les donn√©es de Google Maps.',
          it: 'L\'indirizzo √® stato verificato e aggiornato con i dati di Google Maps.'
        },
        city: {
          en: 'City',
          de: 'Stadt',
          es: 'Ciudad',
          fr: 'Ville',
          it: 'Citt√†'
        },
        enterCity: {
          en: 'Enter city',
          de: 'Stadt eingeben',
          es: 'Ingresar ciudad',
          fr: 'Entrer la ville',
          it: 'Inserisci citt√†'
        },
        zipCode: {
          en: 'Zip Code',
          de: 'Postleitzahl',
          es: 'C√≥digo postal',
          fr: 'Code postal',
          it: 'CAP'
        },
        enterZipCode: {
          en: 'Enter zip code',
          de: 'Postleitzahl eingeben',
          es: 'Ingresar c√≥digo postal',
          fr: 'Entrer le code postal',
          it: 'Inserisci CAP'
        },
        country: {
          en: 'Country',
          de: 'Land',
          es: 'Pa√≠s',
          fr: 'Pays',
          it: 'Paese'
        },
        enterCountry: {
          en: 'Enter country',
          de: 'Land eingeben',
          es: 'Ingresar pa√≠s',
          fr: 'Entrer le pays',
          it: 'Inserisci paese'
        },
        areaInSquareMeters: {
          en: 'Area (m¬≤)',
          de: 'Fl√§che (m¬≤)',
          es: '√Årea (m¬≤)',
          fr: 'Surface (m¬≤)',
          it: 'Superficie (m¬≤)'
        },
        rooms: {
          en: 'Rooms',
          de: 'Zimmer',
          es: 'Habitaciones',
          fr: 'Pi√®ces',
          it: 'Stanze'
        },
        numberOfRooms: {
          en: 'Number of rooms',
          de: 'Anzahl der Zimmer',
          es: 'N√∫mero de habitaciones',
          fr: 'Nombre de pi√®ces',
          it: 'Numero di stanze'
        },
        purchasePrice: {
          en: 'Purchase Price',
          de: 'Kaufpreis',
          es: 'Precio de compra',
          fr: 'Prix d\'achat',
          it: 'Prezzo d\'acquisto'
        },
        enterPurchasePrice: {
          en: 'Enter purchase price',
          de: 'Kaufpreis eingeben',
          es: 'Ingresar precio de compra',
          fr: 'Entrer le prix d\'achat',
          it: 'Inserisci prezzo d\'acquisto'
        },
        status: {
          en: 'Status',
          de: 'Status',
          es: 'Estado',
          fr: 'Statut',
          it: 'Stato'
        },
        selectStatus: {
          en: 'Select status',
          de: 'Status ausw√§hlen',
          es: 'Seleccionar estado',
          fr: 'S√©lectionner le statut',
          it: 'Seleziona stato'
        },
        prospect: {
          en: 'Prospect',
          de: 'Prospekt',
          es: 'Prospecto',
          fr: 'Prospect',
          it: 'Prospettiva'
        },
        analyzing: {
          en: 'Analyzing',
          de: 'Analyse',
          es: 'Analizando',
          fr: 'Analyse',
          it: 'Analisi'
        },
        negotiating: {
          en: 'Negotiating',
          de: 'Verhandlung',
          es: 'Negociando',
          fr: 'N√©gociation',
          it: 'Negoziazione'
        },
        underContract: {
          en: 'Under Contract',
          de: 'Unter Vertrag',
          es: 'Bajo contrato',
          fr: 'Sous contrat',
          it: 'Sotto contratto'
        },
        owned: {
          en: 'Owned',
          de: 'Im Besitz',
          es: 'En propiedad',
          fr: 'Poss√©d√©',
          it: 'Posseduto'
        },
        pending: {
          en: 'Pending',
          de: 'Ausstehend',
          es: 'Pendiente',
          fr: 'En attente',
          it: 'In attesa'
        },
        sold: {
          en: 'Sold',
          de: 'Verkauft',
          es: 'Vendido',
          fr: 'Vendu',
          it: 'Venduto'
        },
        offMarket: {
          en: 'Off-Market',
          de: 'Vom Markt',
          es: 'Fuera del mercado',
          fr: 'Hors march√©',
          it: 'Fuori mercato'
        },
        rejected: {
          en: 'Rejected',
          de: 'Abgelehnt',
          es: 'Rechazado',
          fr: 'Rejet√©',
          it: 'Rifiutato'
        },
        saveChanges: {
          en: 'Save Changes',
          de: '√Ñnderungen speichern',
          es: 'Guardar cambios',
          fr: 'Enregistrer les modifications',
          it: 'Salva modifiche'
        },
        editPropertyDetails: {
          en: 'Edit Property Details',
          de: 'Immobiliendetails bearbeiten',
          es: 'Editar detalles de la propiedad',
          fr: 'Modifier les d√©tails de la propri√©t√©',
          it: 'Modifica dettagli propriet√†'
        },
        enhancedSecurity: {
          en: 'Enhanced Security',
          de: 'Erweiterte Sicherheit',
          es: 'Seguridad mejorada',
          fr: 'S√©curit√© renforc√©e',
          it: 'Sicurezza avanzata'
        },
        // Portfolio dashboard translations
        investmentPortfolio: {
          en: 'Investment Portfolio',
          de: 'Investmentportfolio',
          es: 'Portafolio de inversi√≥n',
          fr: 'Portefeuille d\'investissement',
          it: 'Portafoglio d\'investimento'
        },
        trackYourRealEstateInvestments: {
          en: 'Track your real estate investments',
          de: 'Verfolgen Sie Ihre Immobilieninvestitionen',
          es: 'Haga un seguimiento de sus inversiones inmobiliarias',
          fr: 'Suivez vos investissements immobiliers',
          it: 'Monitora i tuoi investimenti immobiliari'
        },
        portfolioValue: {
          en: 'Portfolio Value',
          de: 'Portfoliowert',
          es: 'Valor del portafolio',
          fr: 'Valeur du portefeuille',
          it: 'Valore del portafoglio'
        },
        equity: {
          en: 'Equity',
          de: 'Eigenkapital',
          es: 'Capital',
          fr: 'Fonds propres',
          it: 'Capitale proprio'
        },
        debt: {
          en: 'Debt',
          de: 'Schulden',
          es: 'Deuda',
          fr: 'Dette',
          it: 'Debito'
        },
        cashFlow: {
          en: 'Cash Flow',
          de: 'Cashflow',
          es: 'Flujo de efectivo',
          fr: 'Flux de tr√©sorerie',
          it: 'Flusso di cassa'
        },
        positive: {
          en: 'Positive',
          de: 'Positiv',
          es: 'Positivo',
          fr: 'Positif',
          it: 'Positivo'
        },
        returnsAndGrowth: {
          en: 'Returns & Growth',
          de: 'Rendite & Wachstum',
          es: 'Rendimientos y crecimiento',
          fr: 'Rendements et croissance',
          it: 'Rendimenti e crescita'
        },
        cashOnCashROI: {
          en: 'Cash on Cash ROI',
          de: 'Cash-on-Cash-Rendite',
          es: 'ROI en efectivo',
          fr: 'ROI cash sur cash',
          it: 'ROI cash on cash'
        },
        appreciation: {
          en: 'Appreciation',
          de: 'Wertsteigerung',
          es: 'Apreciaci√≥n',
          fr: 'Appr√©ciation',
          it: 'Apprezzamento'
        },
        totalReturn: {
          en: 'Total Return',
          de: 'Gesamtrendite',
          es: 'Retorno total',
          fr: 'Rendement total',
          it: 'Rendimento totale'
        }
      };
      
      // Update translations with these common UI element translations
      updateTranslations(commonTranslations);
    };
    
    ensureTranslations();
  }, [updateTranslations]);
  
  const handleLanguageChange = (langCode: string) => {
    setLanguage(langCode as any);
    
    // Notify user about language change
    toast({
      title: t('languageChanged'),
      description: `${t('displayLanguageChangedTo')} ${languages.find(l => l.code === langCode)?.name}`,
    });
  };

  const currentLanguage = languages.find(lang => lang.code === language);

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm" className="flex items-center gap-1">
          {isMobile ? (
            <>
              <Languages className="h-4 w-4" />
              <span className="sr-only">{t('language')}</span>
            </>
          ) : (
            <>
              <Languages className="h-4 w-4 mr-1" />
              <span>{currentLanguage?.flag}</span>
              <span className="ml-1">{currentLanguage?.name}</span>
            </>
          )}
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-48">
        <DropdownMenuLabel>{t('selectLanguage')}</DropdownMenuLabel>
        <DropdownMenuSeparator />
        {languages.map((lang) => (
          <DropdownMenuItem
            key={lang.code}
            onClick={() => handleLanguageChange(lang.code)}
            className="flex items-center justify-between cursor-pointer"
          >
            <div className="flex items-center gap-2">
              <span>{lang.flag}</span>
              <span>{lang.name}</span>
            </div>
            {language === lang.code && (
              <Badge variant="outline" className="ml-2 bg-primary text-primary-foreground">
                {t('active')}
              </Badge>
            )}
          </DropdownMenuItem>
        ))}
      </DropdownMenuContent>
    </DropdownMenu>
  );
};

export default LanguageSwitcher;
